#0 building with "default" instance using docker driver

#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile: 4.48kB 0.0s done
#1 DONE 0.0s

#2 [internal] load metadata for public.ecr.aws/docker/library/node:22-alpine
#2 DONE 0.5s

#3 [internal] load .dockerignore
#3 transferring context: 131B done
#3 DONE 0.0s

#4 [kysely-builder 1/9] FROM public.ecr.aws/docker/library/node:22-alpine@sha256:0340fa682d72068edf603c305bfbc10e23219fb0e40df58d9ea4d6f33a9798bf
#4 DONE 0.0s

#5 [runner 2/7] RUN apk update && apk upgrade && apk add --no-cache libc6-compat shadow curl dumb-init && npm install -g npm@latest
#5 CACHED

#6 [runner 3/7] WORKDIR /app
#6 CACHED

#7 [runner 4/7] RUN addgroup -S -g 1001 expressjs &&     adduser -S -u 1001 -G expressjs expressjs
#7 CACHED

#8 [kysely-builder 8/9] RUN ls -la dist/cjs/index.js dist/esm/index.js ||     (echo "❌ Build failed: dist files not found" && exit 1)
#8 CACHED

#9 [kysely-builder 7/9] RUN npx tsc -p tsconfig.json &&     npx tsc -p tsconfig-cjs.json
#9 CACHED

#10 [kysely-builder 6/9] RUN npm install --no-save typescript@~5.9.3 --ignore-scripts
#10 CACHED

#11 [kysely-builder 4/9] RUN git clone https://github.com/OlegKarenkikh/kysely.git . &&     git checkout 64a12c470b1a5387b842acf09094e2aa1e4149b0
#11 CACHED

#12 [kysely-builder 5/9] RUN sed -i 's|git://github.com/kysely-org/kysely.git|https://github.com/OlegKarenkikh/kysely.git|' package.json
#12 CACHED

#13 [kysely-builder 3/9] WORKDIR /kysely
#13 CACHED

#14 [kysely-builder 2/9] RUN apk update && apk add --no-cache git
#14 CACHED

#15 [kysely-builder 9/9] RUN rm -rf node_modules test example site .github
#15 CACHED

#16 [internal] load build context
#16 transferring context: 338.07kB 0.2s done
#16 DONE 0.2s

#17 [pruner 3/8] RUN npm install turbo@^2.6.1 --global
#17 CACHED

#18 [pruner 2/8] RUN apk update && apk add --no-cache libc6-compat tar gzip git
#18 CACHED

#19 [pruner 4/8] WORKDIR /app
#19 CACHED

#20 [pruner 5/8] COPY . .
#20 DONE 3.2s

#21 [pruner 6/8] RUN rm -rf packages/kysely
#21 DONE 2.6s

#22 [pruner 7/8] COPY --from=kysely-builder /kysely ./packages/kysely
#22 DONE 2.0s

#23 [pruner 8/8] RUN turbo prune --scope=worker --docker
#23 1.920  WARNING  No locally installed `turbo` found in your repository. Using globally installed version (2.7.2), which can cause unexpected behavior.
#23 1.920
#23 1.920 Installing the version in your repository (^2.6.1) before calling `turbo` will result in more predictable behavior across environments.
#23 1.929
#23 1.929 Attention:
#23 1.929 Turborepo now collects completely anonymous telemetry regarding usage.
#23 1.929 This information is used to shape the Turborepo roadmap and prioritize features.
#23 1.929 You can learn more, including how to opt-out if you'd not like to participate in this anonymous program, by visiting the following URL:
#23 1.929 https://turborepo.com/docs/telemetry
#23 1.929
#23 1.929 • turbo 2.7.2
#23 2.176 Generating pruned monorepo for worker in /app/out
#23 2.269  - Added @langfuse/shared
#23 2.270  - Added @repo/eslint-config
#23 2.271  - Added @repo/typescript-config
#23 2.379  - Added kysely
#23 2.397  - Added worker
#23 DONE 2.8s

#24 [builder  2/17] RUN apk update && apk add --no-cache libc6-compat git tar gzip python3 make g++ openssl openssl-dev
#24 CACHED

#25 [builder  3/17] RUN npm install -g pnpm@9.15.0
#25 CACHED

#26 [builder  4/17] RUN npm install -g turbo@^2.6.1
#26 CACHED

#27 [builder  5/17] WORKDIR /app
#27 CACHED

#28 [builder  8/17] COPY --from=pruner /app/out/json/ .
#28 CACHED

#29 [builder  6/17] COPY --from=pruner /app/out/pnpm-lock.yaml ./pnpm-lock.yaml
#29 CACHED

#30 [builder  9/17] RUN pnpm update next --lockfile-only
#30 CACHED

#31 [builder  7/17] COPY --from=pruner /app/out/pnpm-workspace.yaml ./pnpm-workspace.yaml
#31 CACHED

#32 [builder 10/17] RUN pnpm install --no-frozen-lockfile
#32 CACHED

#33 [builder 11/17] COPY --from=pruner /app/out/full/ .
#33 DONE 66.8s

#34 [builder 12/17] COPY --from=kysely-builder /kysely/dist ./packages/kysely/dist
#34 DONE 66.1s

#35 [builder 13/17] RUN pnpm audit --audit-level=moderate
#35 68.42 No known vulnerabilities found
#35 DONE 68.4s

#36 [builder 14/17] RUN echo "=== Checking kysely dist ===" &&     ls -la packages/kysely/dist/cjs/index.js packages/kysely/dist/esm/index.js &&     echo "=== kysely package.json exports ===" &&     cat packages/kysely/package.json | grep -A 20 '"exports"'
#36 63.50 === Checking kysely dist ===
#36 63.50 -rw-r--r--    1 root     root         16167 Dec 30 15:55 packages/kysely/dist/cjs/index.js
#36 63.50 -rw-r--r--    1 root     root         11187 Dec 30 15:55 packages/kysely/dist/esm/index.js
#36 63.50 === kysely package.json exports ===
#36 63.50   "exports": {
#36 63.50     ".": {
#36 63.50       "import": "./dist/esm/index.js",
#36 63.50       "require": "./dist/cjs/index.js",
#36 63.50       "default": "./dist/cjs/index.js"
#36 63.50     },
#36 63.50     "./helpers/postgres": {
#36 63.50       "import": "./dist/esm/helpers/postgres.js",
#36 63.50       "require": "./dist/cjs/helpers/postgres.js",
#36 63.50       "default": "./dist/cjs/helpers/postgres.js"
#36 63.50     },
#36 63.50     "./helpers/mysql": {
#36 63.50       "import": "./dist/esm/helpers/mysql.js",
#36 63.50       "require": "./dist/cjs/helpers/mysql.js",
#36 63.50       "default": "./dist/cjs/helpers/mysql.js"
#36 63.50     },
#36 63.50     "./helpers/mssql": {
#36 63.50       "import": "./dist/esm/helpers/mssql.js",
#36 63.50       "require": "./dist/cjs/helpers/mssql.js",
#36 63.50       "default": "./dist/cjs/helpers/mssql.js"
#36 63.50     },
#36 DONE 63.5s

#37 [builder 15/17] RUN echo "=== Building @langfuse/shared directly ===" &&     cd packages/shared &&     pnpm run build 2>&1 | tee /tmp/shared-build.log ||     (echo "❌ Shared build failed, showing last 100 lines:" &&      tail -100 /tmp/shared-build.log &&      exit 1)
#37 69.08 === Building @langfuse/shared directly ===
#37 69.88
#37 69.88 > @langfuse/shared@1.0.0 build /app/packages/shared
#37 69.88 > tsc
#37 69.88
#37 88.81 scripts/seeder/seed-dataset-versions.ts(2,10): error TS2305: Module '"../../src/index"' has no exported member 'PrismaClient'.
#37 88.81 scripts/seeder/seed-postgres.ts(7,8): error TS2305: Module '"../../src/index"' has no exported member 'JobConfiguration'.
#37 88.81 scripts/seeder/seed-postgres.ts(8,3): error TS2305: Module '"../../src/index"' has no exported member 'JobExecutionStatus'.
#37 88.81 scripts/seeder/seed-postgres.ts(9,3): error TS2305: Module '"../../src/index"' has no exported member 'PrismaClient'.
#37 88.81 scripts/seeder/seed-postgres.ts(10,8): error TS2305: Module '"../../src/index"' has no exported member 'Project'.
#37 88.81 scripts/seeder/seed-postgres.ts(12,3): error TS2724: '"../../src/index"' has no exported member named 'ScoreDataType'. Did you mean 'ScoreDataTypeEnum'?
#37 88.81 src/db.ts(4,10): error TS2305: Module '"@prisma/client"' has no exported member 'Prisma'.
#37 88.81 src/db.ts(4,18): error TS2305: Module '"@prisma/client"' has no exported member 'PrismaClient'.
#37 88.81 src/domain/automations.ts(1,10): error TS2305: Module '"@prisma/client"' has no exported member 'Action'.
#37 88.81 src/domain/automations.ts(1,18): error TS2305: Module '"@prisma/client"' has no exported member 'Trigger'.
#37 88.81 src/features/batchExport/types.ts(3,10): error TS2305: Module '"@prisma/client"' has no exported member 'BatchExport'.
#37 88.81 src/features/experiments/utils.ts(1,10): error TS2724: '"../../db"' has no exported member named 'Prisma'. Did you mean 'prisma'?
#37 88.81 src/features/scoreConfigs/validation.ts(2,10): error TS2305: Module '"@prisma/client"' has no exported member 'ScoreConfig'.
#37 88.81 src/features/scores/interfaces/ui/types.ts(1,10): error TS2305: Module '"@prisma/client"' has no exported member 'ScoreDataType'.
#37 88.81 src/interfaces/parseDbOrg.ts(1,15): error TS2305: Module '"@prisma/client"' has no exported member 'Organization'.
#37 88.81 src/server/auth/apiKeys.ts(1,10): error TS2305: Module '"@prisma/client"' has no exported member 'PrismaClient'.
#37 88.81 src/server/auth/apiKeys.ts(1,24): error TS2305: Module '"@prisma/client"' has no exported member 'ApiKeyScope'.
#37 88.81 src/server/auth/invalidateApiKeys.ts(5,15): error TS2305: Module '"../../db"' has no exported member 'ApiKey'.
#37 88.81 src/server/auth/invalidateApiKeys.ts(71,11): error TS7006: Parameter 'key' implicitly has an 'any' type.
#37 88.81 src/server/auth/invalidateApiKeys.ts(72,14): error TS7006: Parameter 'hash' implicitly has an 'any' type.
#37 88.81 src/server/auth/invalidateApiKeys.ts(81,40): error TS7006: Parameter 'hash' implicitly has an 'any' type.
#37 88.81 src/server/auth/invalidateApiKeys.ts(106,11): error TS7006: Parameter 'key' implicitly has an 'any' type.
#37 88.81 src/server/auth/invalidateApiKeys.ts(107,14): error TS7006: Parameter 'hash' implicitly has an 'any' type.
#37 88.81 src/server/auth/invalidateApiKeys.ts(116,40): error TS7006: Parameter 'hash' implicitly has an 'any' type.
#37 88.81 src/server/auth/types.ts(4,10): error TS2305: Module '"../../"' has no exported member 'ApiKeyScope'.
#37 88.81 src/server/auth/userProjectRoleAuth.ts(1,18): error TS2724: '"../../db"' has no exported member named 'Prisma'. Did you mean 'prisma'?
#37 88.81 src/server/auth/userProjectRoleAuth.ts(1,26): error TS2305: Module '"../../db"' has no exported member 'Role'.
#37 88.81 src/server/auth/userProjectRoleAuth.ts(1,32): error TS2305: Module '"../../db"' has no exported member 'ProjectMembership'.
#37 88.81 src/server/datasets/schemaTypes.ts(2,15): error TS2305: Module '"../../db"' has no exported member 'Dataset'.
#37 88.81 src/server/datasets/schemaValidation.ts(1,15): error TS2459: Module '"../../db"' declares 'PrismaClient' locally, but it is not exported.
#37 88.81 src/server/filterToPrisma.ts(1,10): error TS2305: Module '"@prisma/client"' has no exported member 'Prisma'.
#37 88.81 src/server/ingestion/modelMatch.ts(1,10): error TS2305: Module '"../../"' has no exported member 'Model'.
#37 88.81 src/server/ingestion/modelMatch.ts(1,17): error TS2305: Module '"../../"' has no exported member 'Price'.
#37 88.81 src/server/ingestion/modelMatch.ts(1,24): error TS2305: Module '"../../"' has no exported member 'Prisma'.
#37 88.81 src/server/ingestion/validateAndInflateScore.ts(7,18): error TS2305: Module '"../../db"' has no exported member 'ScoreDataType'.
#37 88.81 src/server/ingestion/validateAndInflateScore.ts(143,4): error TS2366: Function lacks ending return statement and return type does not include 'undefined'.
#37 88.81 src/server/ingestion/validateAndInflateScore.ts(149,7): error TS2322: Type 'string | null | undefined' is not assignable to type 'string | number | null'.
#37 88.81   Type 'undefined' is not assignable to type 'string | number | null'.
#37 88.81 src/server/llm/types.ts(1,10): error TS2305: Module '"@prisma/client"' has no exported member 'LlmApiKeys'.
#37 88.81 src/server/orderByToPrisma.ts(3,10): error TS2305: Module '"@prisma/client"' has no exported member 'Prisma'.
#37 88.81 src/server/repositories/automation-repository.ts(2,3): error TS2305: Module '"../../db"' has no exported member 'Action'.
#37 88.81 src/server/repositories/automation-repository.ts(3,3): error TS2305: Module '"../../db"' has no exported member 'ActionExecutionStatus'.
#37 88.81 src/server/repositories/automation-repository.ts(4,3): error TS2305: Module '"../../db"' has no exported member 'JobConfigState'.
#37 88.81 src/server/repositories/automation-repository.ts(5,3): error TS2724: '"../../db"' has no exported member named 'Prisma'. Did you mean 'prisma'?
#37 88.81 src/server/repositories/automation-repository.ts(7,3): error TS2305: Module '"../../db"' has no exported member 'Trigger'.
#37 88.81 src/server/repositories/automation-repository.ts(54,43): error TS2322: Type 'unknown' is not assignable to type 'string'.
#37 88.81 src/server/repositories/automation-repository.ts(129,47): error TS7006: Parameter 'trigger' implicitly has an 'any' type.
#37 88.81 src/server/repositories/automation-repository.ts(131,41): error TS7006: Parameter 'automation' implicitly has an 'any' type.
#37 88.81 src/server/repositories/automation-repository.ts(233,27): error TS7006: Parameter 'automation' implicitly has an 'any' type.
#37 88.81 src/server/repositories/events.ts(134,22): error TS7006: Parameter 'm' implicitly has an 'any' type.
#37 88.81 src/server/repositories/events.ts(165,29): error TS7006: Parameter 'm' implicitly has an 'any' type.
#37 88.81 src/server/repositories/events.ts(167,29): error TS7006: Parameter 'm' implicitly has an 'any' type.
#37 88.81 src/server/repositories/events.ts(169,29): error TS7006: Parameter 'm' implicitly has an 'any' type.
#37 88.81 src/server/repositories/observations.ts(579,32): error TS7006: Parameter 't' implicitly has an 'any' type.
#37 88.81 src/server/repositories/observations.ts(580,32): error TS7006: Parameter 'm' implicitly has an 'any' type.
#37 88.81 src/server/repositories/observations.ts(1047,25): error TS7006: Parameter 'p' implicitly has an 'any' type.
#37 88.81 src/server/repositories/observations_converters.ts(22,15): error TS2305: Module '"@prisma/client"' has no exported member 'Model'.
#37 88.81 src/server/repositories/observations_converters.ts(22,22): error TS2305: Module '"@prisma/client"' has no exported member 'Price'.
#37 88.81 src/server/repositories/observations_converters.ts(70,27): error TS7006: Parameter 'm' implicitly has an 'any' type.
#37 88.81 src/server/repositories/observations_converters.ts(72,27): error TS7006: Parameter 'm' implicitly has an 'any' type.
#37 88.81 src/server/repositories/observations_converters.ts(74,27): error TS7006: Parameter 'm' implicitly has an 'any' type.
#37 88.81 src/server/repositories/scores.ts(1,10): error TS2305: Module '"@prisma/client"' has no exported member 'ScoreDataType'.
#37 88.81 src/server/repositories/scores.ts(754,23): error TS7006: Parameter 'config' implicitly has an 'any' type.
#37 88.81 src/server/repositories/scores_converters.ts(1,10): error TS2305: Module '"@prisma/client"' has no exported member 'ScoreDataType'.
#37 88.81 src/server/repositories/trace-sessions.ts(63,44): error TS7006: Parameter 's' implicitly has an 'any' type.
#37 88.81 src/server/services/DashboardService/DashboardService.ts(53,46): error TS7006: Parameter 'dashboard' implicitly has an 'any' type.
#37 88.81 src/server/services/DashboardService/DashboardService.ts(256,40): error TS7006: Parameter 'widget' implicitly has an 'any' type.
#37 88.81 src/server/services/DashboardService/DashboardService.ts(381,15): error TS7006: Parameter 'd' implicitly has an 'any' type.
#37 88.81 src/server/services/DashboardService/DashboardService.ts(425,39): error TS7006: Parameter 'tx' implicitly has an 'any' type.
#37 88.81 src/server/services/DashboardService/types.ts(1,10): error TS2305: Module '"@prisma/client"' has no exported member 'DashboardWidgetChartType'.
#37 88.81 src/server/services/DashboardService/types.ts(1,36): error TS2305: Module '"@prisma/client"' has no exported member 'DashboardWidgetViews'.
#37 88.81 src/server/services/DatasetService/DatasetItemManager.ts(2,10): error TS2305: Module '"../../../db"' has no exported member 'Dataset'.
#37 88.81 src/server/services/DatasetService/DatasetItemManager.ts(2,19): error TS2305: Module '"../../../db"' has no exported member 'DatasetItem'.
#37 88.81 src/server/services/DatasetService/DatasetItemManager.ts(2,32): error TS2305: Module '"../../../db"' has no exported member 'DatasetStatus'.
#37 88.81 src/server/services/DatasetService/DatasetItemValidator.ts(1,10): error TS2724: '"../../../db"' has no exported member named 'Prisma'. Did you mean 'prisma'?
#37 88.81 src/server/services/DatasetService/types.ts(1,10): error TS2305: Module '"../../../db"' has no exported member 'DatasetStatus'.
#37 88.81 src/server/services/DatasetService/types.ts(1,25): error TS2724: '"../../../db"' has no exported member named 'Prisma'. Did you mean 'prisma'?
#37 88.81 src/server/services/PromptService/index.ts(1,10): error TS2305: Module '"@prisma/client"' has no exported member 'Prompt'.
#37 88.81 src/server/services/PromptService/index.ts(1,18): error TS2305: Module '"@prisma/client"' has no exported member 'PrismaClient'.
#37 88.81 src/server/services/PromptService/index.ts(331,14): error TS7006: Parameter 'dep' implicitly has an 'any' type.
#37 88.81 src/server/services/PromptService/index.ts(381,16): error TS7006: Parameter 'label' implicitly has an 'any' type.
#37 88.81 src/server/services/PromptService/types.ts(1,15): error TS2305: Module '"../../../db"' has no exported member 'Prompt'.
#37 88.81 src/server/utils/billingCycleHelpers.ts(2,15): error TS2305: Module '"@prisma/client"' has no exported member 'Organization'.
#37 88.89  ELIFECYCLE  Command failed with exit code 2.
#37 DONE 88.9s

#38 [builder 16/17] RUN echo "=== Building worker directly ===" &&     cd worker &&     pnpm run build 2>&1 | tee /tmp/worker-build.log ||     (echo "❌ Worker build failed, showing last 100 lines:" &&      tail -100 /tmp/worker-build.log &&      exit 1)
